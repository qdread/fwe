---
title: "Waste tracking and analytics analysis"
author: "Quentin D. Read"
date: "2/7/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE) # default to not show any of the code.
```

# Summary

This is a financial cost - environmental benefit analysis of the adoption of food waste tracking & analytics systems (e.g., Leanpath) by all foodservice establishments in the USA with sufficient volume to justify the cost of implementation. This is a refinement of the analysis presented by ReFED in their "Roadmap" report.

**Once I get the results, insert a brief summary of them here.**

This is my first attempt at doing an intervention analysis of this kind. We can do a similar analysis for other food waste reduction interventions. Ultimately the goal would be to do multiple analyses and compare them.

# Outline of procedure

The analysis proceeds as follows:

1. Identify the industry groups that can adopt the intervention, using NAICS industry classifications and BEA codes that represent aggregations of NAICS industries.
2. Total up the number of establishments and sales volume by size class within each industry, using SUSB data.
3. Impute any missing or censored values.
4. Use the predefined threshold of size class that can adopt the intervention, and the proportion of expenses by each industry that consists of food, to determine the number of establishments and proportion of receipts in each industry that will be affected by the intervention.
5. Use LAFA data to get a baseline waste rate for each of the target industries, which is a weighted average of the waste rates for each of the food groups the industry uses. (In this case it is a consumer level intervention so we will use the consumer level waste rates)
6. Use our assumptions of waste reduction rate achieved by the intervention to determine the dollar value of food waste averted by the intervention for each industry
7. Use the USEEIO 2012 model to find the environmental impact associated with this averted food waste.
8. Compare the impact averted (environmental benefit) with the annual cost of intervention (using the analysis done by Mary and multiplied by the number of establishments).
9. Repeat this analysis for different values within the upper and lower bounds of our assumptions, as an uncertainty analysis to see how much the results are affected by different assumptions.

# Assumptions

## Costs of establishment

The upper and lower bounds for annual cost per establishment of implementing waste tracking and analytics systems, rounded to the nearest thousand, are **9,000** and **$20,000**. The uncertainty is due to uncertainty or variation in the following:

* initial cost of purchasing the system (assumed range \$2,000-\$5,000)
* annual licensing fee (assumed range \$1,000-\$2,000)
* cost of training employees (assumed range \$200-\$615, based on 10th to 90th percentile of employees' hourly wages in the foodservice industry)
* cost of daily setup time (assumed range \$4,106-\$7,659, again based on range of wages)
* cost of transaction time (assumed range \$411-\$766, again based on range of wages)
* cost of time spent reviewing records generated by analytics system (assumed range \$848-\$2,614, again based on range of wages)
* cost of time spent communicating and implementing changes suggested by analytics review (assumed range \$1,697-\$5,228, again based on range of wages)

The 10th-90th percentile range of wages for chefs and head cooks is fixed at \$12.66-\$39.01, and for food preparation workers at \$8.68-\$16.19 (*source: BLS, June 2019*)

Other potential sources of uncertainty which we could also incorporate into the range of possible cost values, but that are not currently incorporated, are: 

* the number of years over which to annualize the one-time purchase cost (currently fixed at 5)
* the interest rate used for annualization (fixed at 7%)
* the number of hours per year needed to train each employee (2)
* the number of employees requiring training per establishment (6)
* the daily setup time, in hours (1)
* the time per transaction, in seconds (12)
* the number of transactions per establishment per day (30)
* the number of hours per week needed to review records (1)
* the number of hours per week needed to communicate and implement changes (2)
* the benefits rate (31.4%; *source: BLS, June 2019*)

## Waste reduction

We define the effectiveness of the intervention as the percent reduction in food loss or waste achieved by implementing it. Thus, this number is very important for the final result. We are using a range of **40%-50%** reduction in kitchen waste. *Later we may also want to do the analysis using even lower numbers for waste reduction if this number is too optimistically high.* **Also I can't remember the source of this number. Is it from ReFED or Steve?**

We also need to know what percent of the food waste generated by foodservice establishments is made in the kitchen, relative to "plate waste" left over by the customers. We are using lower and upper bounds of **70%-97%** for this value, with a mode of **85%**, taken from three published studies conducted in Europe and the Middle East on foodservice establishments. This value is needed because baseline waste rate data from LAFA and other sources does not distinguish between cooking loss and plate loss at the consumer level &mdash; there is only one percentage loss value given.

## Minimum size of establishments that can adopt the intervention

Our data source for number of establishments by industry and by size class, Statistics of U.S. Businesses, aggregates firms by number of employees. We are assuming that any firm with **20 or more** employees can potentially adopt the intervention. *Later this assumption could be changed, or we could even specify different thresholds for different sectors or different industries within each sector. We are using a version of SUSB that I coarsened down to 4 size classes so that it could be compared to other datasets, but there are finer size classes available under 20 employees if we need them later.*

## Other assumptions

The decision of which BEA industries (and the component NAICS industries, for partially used industries) to include or exclude is an important assumption. See details below.

A further assumption is that the proportion of each industry that is affected by the intervention is related to the proportion of food expenses the industry pays for. That should be a tenable assumption in this case.

We also made a few assumptions in the process of imputing a few missing values, which could also be tested in the process of the uncertainty analysis. More detail on this is given below.

# Analysis

## 0. Gather needed data

We are using the following datasets and tables:

* Statistics of U.S. Businesses (SUSB) for 2012, for the numbers of employees, establishments, and total receipts by 6-digit NAICS code.
* Crosswalks assembled for previous work that link NAICS codes to the more aggregated BEA industries, and provide the proportion of expenses consisting of food for each BEA industry.
* USDA Loss-adjusted Food Availability (LAFA) data for each food type, to get baseline waste rates.
* The cost values and other individual values we assembled, described in the "Assumptions" section above.
* The USEEIO model requires the BEA input-output tables as well as satellite environmental impact tables for the relevant impact categories.

```{r load_data}
# Load packages and check whether this is being run locally or on rstudio server.
library(tidyverse)

is_local <- dir.exists('Q:/')
fp <- ifelse(is_local, 'Q:', '/nfs/qread-data')
fp_github <- file.path(ifelse(is_local, '~/Documents/GitHub', '~'))

# Load numbers of establishments by NAICS
susb_naics <- read_csv(file.path(fp, 'csv_exports/SUSB_NAICS_allvariables.csv'))
# Load the BEA code data (erroneously called NAICS)
bea_codes <- read_csv(file.path(fp, 'crossreference_tables/naics_crosswalk_final.csv'))
# Load NAICS BEA crosswalks
load(file.path(fp, 'crossreference_tables/NAICS_BEA_SCTG_crosswalk.RData'))
bea_naics <- read_csv(file.path(fp, 'crossreference_tables/BEA_NAICS07_NAICS12_crosswalk.csv'))
```

```{r assumptions}
# For now, use the final output values from the cost sheet Mary made.
cost_range <- c(lower = 8749, upper = 20102) # Lower and upper bounds for annual cost, based on percentiles for employee hourly wages.

waste_reduction <- c(lower = 0.4, upper = 0.5, mode = 0.45) # Waste reduction achievable, rates from ReFED?

prop_kitchen_waste <- c(lower = 0.7, upper = 0.97, mode = 0.85) # Proportion kitchen waste (all other than plate waste), estimated from a few sources
```

## 1. Identify industries to target

I decided which BEA industries, of the 389 included in the detailed input-output table, to include in the foodservice classification. I classified foodservice industries into three broader categories: restaurants, the tourism/hospitality industry, and institutional foodservice.
