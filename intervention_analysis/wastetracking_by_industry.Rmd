---
title: "Waste tracking intervention, by industry"
author: "Quentin D. Read"
date: "February 21, 2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE) # default to not show any of the code, messages, or warnings.
trunc_ellipsis <- function(x, n) if_else(nchar(x) < 30, x, paste(substr(x, 1, n), '...')) # Convenience function to cut off long labels.

```

# Summary

The original cost-effectiveness analysis of the waste tracking intervention was done using the marginal row sums of the use table so that hypothetical impact averted was calculated across all the foodservice industries. However we were also interested in looking at how the total impact averted, and the cost per unit impact reduction, might differ across individual industries that could participate in the intervention.

In this document are the results of a reanalysis keeping the individual industries separate, with all other details of the analysis the same as before.

The results show that the total baseline impact (and total potential impact averted) are highest for restaurants, followed by hospitals, hotels, universities, and residential housing/care institutions. Other smaller industry groups in the tourism/hospitality sector make up a small fraction of the total. The relative cost per unit reduction varied widely among the industries (but did not vary that much among the different environmental impact categories, since all industries are purchasing from more or less the same primary agricultural sectors). Because of the large scale of their individual establishments, and because we assumed cost per establishment is constant, hospitals, universities, and community food/housing/care institutions show much cheaper costs per unit impact reduction than other industries. 

# Results

Because the methods are identical to the ones described in waste_tracking_analytics.pdf, except for the fact that they are done separately for each industry, the methods aren't described here.

Museums/historical sites and air transport are excluded from the results presented here because they were small in total size but high outliers in cost per unit impact, leading to bias in the display of the results.

```{r load results and process}
# Note: the code is not run in this document because it would take too long to render each time (lots of calls to eeio_lcia)
# Instead load the precalculated results, output from wta_by_industry.R
# Then just show tables and figures in the document

library(tidyverse)

is_local <- dir.exists('Q:/')
fp <- ifelse(is_local, 'Q:', '/nfs/qread-data')

final_result_byindustry <- read_csv(file.path(fp, 'scenario_results/interventions/eeio_wta_byindustry_5categories_processed.csv'))

impact_dat <- final_result_byindustry %>%
  filter(!grepl('Air|Museum', BEA_Title)) %>%
  select(sector, BEA_Title, category, baseline, net_impact_averted_lower, net_impact_averted_upper) %>%
  mutate(net_impact_averted_mean = (net_impact_averted_upper + net_impact_averted_lower)/2) 

costper_dat <-  final_result_byindustry %>%
  filter(!grepl('Air|Museum', BEA_Title)) %>%
  select(sector, BEA_Title, category, cost_per_reduction_lower, cost_per_reduction_upper) %>%
  mutate(cost_per_reduction_mean = (cost_per_reduction_lower + cost_per_reduction_upper)/2) 
```

\newpage

## Total impact and potential averted impact

The individual industries differ in the total environmental impact embodied in the food they purchase; this is a function of their total food purchases so will increase with number of establishments and also with the proportion of their total purchases that is food. The relative potential reduction of this impact if they adopt waste tracking & analytics systems is very similar for each industry (about 9%). The relative potential reduction is also very similar across impact categories (GHG emissions, land use, water use, energy use, etc.) because each of the secondary foodservice industries purchases from basically the same set of primary agriculture/food processing industries. There are slight differences in the mix of industries they purchase from, but not enough to noticeably affect the result. Therefore I only show the result for greenhouse gas reduction potential (other categories' figures would look roughly the same).

```{r ghg impact figure}
impact_dat %>%
  mutate(BEA_Title = trunc_ellipsis(BEA_Title, 30)) %>%
  filter(grepl('greenhouse', category)) %>%
  arrange(sector, baseline) %>%
  mutate(BEA_Title = factor(BEA_Title, levels = unique(BEA_Title))) %>% # rearrange to show in order by baseline within sector.
  ggplot(aes(x = BEA_Title)) +
  geom_col(aes(y = baseline), alpha = 0.5) +
  geom_col(aes(y = baseline - net_impact_averted_mean)) +
  geom_errorbar(aes(ymin = baseline - net_impact_averted_upper, ymax = baseline - net_impact_averted_lower), width = 0.1, color = 'white') +
  facet_grid(sector ~ ., scales = 'free') +
  labs(x = 'industry') +
  scale_y_continuous(name = parse(text="greenhouse~gas~potential~(MT~CO[2]~eq.)"), expand = expand_scale(mult = c(0, 0.1))) +
  coord_flip() +
  theme_bw() +
  theme(panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        strip.background = element_blank())

```

In the figure, the light portion of the bar represents the potential GHG emissions averted by applying the intervention, and the total height of the bar is the baseline impact. There are white error bars around the proportion impact averted; this uncertainty is based only on not knowing exactly which industries are used to provide the equipment needed to apply the intervention. Therefore the error bars are very narrow and show low uncertainty. Once more sources of uncertainty are added, the error bars will likely be wider.

\newpage

## Cost per unit impact averted

The cost per unit impact averted is much more variable by industry. This is because we assume that establishments all incur the same fixed cost to implement the intervention, regardless of the size of the individual establishment. For this reason, industry codes with very large establishments, especially institutions like hospitals and universities, and large establishments in the tourism/hospitality sector such as cruise ships, stadiums, casinos, and hotels, have relatively cheap cost per unit impact averted. Restaurants, because the scale of the establishment is smaller but the cost is still the same, would require higher cost to reduce a given impact.

The cost is estimated to be roughly between \$9,000 and \$20,000 annually. Therefore, the lower and upper bounds of the cost per unit impact estimates vary by a factor of ~2.

Here I show five different impact categories, which have different units and therefore different absolute costs, but the relative ordering of the industries is more or less the same for each.

```{r cost figures}
cost_figs <- costper_dat %>%
  mutate(BEA_Title = trunc_ellipsis(BEA_Title, 30),
         category = rep(c('energy ($/MJ)', 'eutrophication ($/kg N)', 'greenhouse gas ($/kg CO2)', 'land ($/m2)', 'water ($/m3)'), nrow(.)/5)) %>%
  group_by(category) %>%
  group_map(function(dat, ...) 
    dat %>% arrange(sector, -cost_per_reduction_mean) %>%
      mutate(BEA_Title = factor(BEA_Title, levels = unique(BEA_Title))) %>%
      ggplot(aes(x = BEA_Title)) +
      geom_point(aes(y = cost_per_reduction_mean), size = 3) +
      geom_errorbar(aes(ymin = cost_per_reduction_lower, ymax = cost_per_reduction_upper), width = 0.1) +
      facet_grid(sector ~ ., scales = 'free') +
      labs(x = 'industry') +
      scale_y_continuous(expand = expand_scale(mult = c(0, 0.1)), labels = scales::dollar) +
      coord_flip() +
      theme_bw() +
      theme(panel.grid.major.y = element_blank(),
            panel.grid.minor.x = element_blank(),
            strip.background = element_blank()),
    keep = TRUE )

cost_figs <- map2(cost_figs, c('energy~("$"/MJ)', 'eutrophication~("$"/kg~N)', 'greenhouse~gas~("$"/kg~CO[2]~eq.)', 'land~("$"/m^2)', 'water~("$"/m^3)'),
                  ~ .x + labs(y = parse(text=.y)))

for (fig in cost_figs) {
  print(fig)
}
```

